[{"id":"6ab4cd3e.954b34","type":"websocket-listener","z":"fa7c7cbc.05838","path":"/ws/map","wholemsg":"false"},{"id":"25eb0ab4.da14f6","type":"websocket-listener","z":"fa7c7cbc.05838","path":"/ws/cloudant","wholemsg":"false"},{"id":"894bd09f.76b43","type":"websocket-listener","z":"fa7c7cbc.05838","path":"/ws/audio","wholemsg":"false"},{"id":"d883049e.277cf8","type":"ibmiot in","z":"fa7c7cbc.05838","authentication":"quickstart","apiKey":"","inputType":"evt","deviceId":"08b5cbcfa326","applicationId":"","deviceType":"+","eventType":"+","commandType":"","format":"json","name":"IBM IoT App In (iPad:94128ececff1) (iPhone:1247823ebf04) (Samsung:c4be84722b07)","service":"quickstart","allDevices":false,"allApplications":false,"allDeviceTypes":true,"allEvents":true,"allCommands":false,"allFormats":false,"x":307,"y":72,"wires":[["a0b6b3af.5f495","e5055874.1afaa8","cd054500.32fab8"]]},{"id":"e5055874.1afaa8","type":"function","z":"fa7c7cbc.05838","name":"temp","func":"var temp;\n\n   if (msg.payload.d.AmbTemp !== undefined) {\n        temp     = msg.payload.d.AmbTemp;      // Typical Apple datastructure\n    }\n\n    if (msg.payload.d.ambient_temp !== undefined) {\n        temp     = msg.payload.d.ambient_temp;  // Typical Android datastructure\n    }\n\n    if (msg.payload.d.temp !== undefined) {\n        temp     = msg.payload.d.temp;\n    }  \n\nreturn {payload:temp};\n","outputs":1,"noerr":0,"x":95.5,"y":175,"wires":[["1de0bd6a.e21f43"]]},{"id":"1de0bd6a.e21f43","type":"switch","z":"fa7c7cbc.05838","name":"temp thresh","property":"payload","rules":[{"t":"lte","v":"25"},{"t":"gt","v":"25"}],"checkall":"true","outputs":2,"x":236.5,"y":175,"wires":[["37b2ea34.c84d16"],["a5ea6b64.5a1598"]]},{"id":"a0b6b3af.5f495","type":"debug","z":"fa7c7cbc.05838","name":"device data","active":false,"console":"false","complete":"true","x":727.5,"y":77,"wires":[]},{"id":"37b2ea34.c84d16","type":"template","z":"fa7c7cbc.05838","name":"safe","field":"","template":"Temperature ({{payload}}) within safe limits","x":390.5,"y":141,"wires":[["67f6032c.9809fc","e5b18e03.1a4e7"]]},{"id":"a5ea6b64.5a1598","type":"template","z":"fa7c7cbc.05838","name":"danger","template":"Temperature ({{payload}}) critical","x":387.5,"y":217,"wires":[["e5b18e03.1a4e7","67f6032c.9809fc"]]},{"id":"cd054500.32fab8","type":"function","z":"fa7c7cbc.05838","name":"Check Temperature and create JSON Data","func":"if ( msg !== null)\n{ // if msg !0 null begin\n  // Create data object\n  data = new Object();\n\n  // *****************\n  // Get Data and time\n    var currentdate = new Date();\n    var the_minutes     = \"00\";\n    var the_seconds     = \"00\";\n\n    if ((currentdate.getMinutes() < 10)){\n        the_minutes = \"0\"+currentdate.getMinutes();\n    } else {\n        the_minutes = currentdate.getMinutes();\n    }\n\n    if ((currentdate.getSeconds() < 10)){\n        the_seconds = \"0\"+currentdate.getSeconds();\n    } else {\n        the_seconds = currentdate.getSeconds();\n    }\n\n    data.date   = currentdate.getDate() + \".\" + (currentdate.getMonth()+1)  + \".\" + currentdate.getFullYear();\n    data.time   = currentdate.getHours() + \":\"  + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n    data.image  = \"undefined\";\n    data.imageLocalURI = \"undefined\";\n\n  // *****************\n  // Get the concrete Sensor data\n  // the input can be different based on your device/app type:\n  // \"Apple, Android, Simulator do have different datastructure in the payload\"\n    //-----------------------------------------------------------------------\n    data.temp = \"20.0000\"; // default\n    if (msg.payload.d.AmbTemp !== undefined) {\n        data.temp     = msg.payload.d.AmbTemp;      // Typical Apple datastructure\n    }\n\n    if (msg.payload.d.ambient_temp !== undefined) {\n        data.temp     = msg.payload.d.ambient_temp;  // Typical Android datastructure\n    }\n\n    if (msg.payload.d.temp !== undefined) {\n        data.temp     = msg.payload.d.temp;          // Typical Simulator datastructure\n    }\n    //--------------------------------------------------------------------------\n    data.iptemp = \"20.0000\"; //default\n    if (msg.payload.d.IRTemp !== undefined) {\n        data.irtemp   = msg.payload.d.IRTemp;        // Typical Apple datastructure\n    }\n\n    if (msg.payload.d.object_temp !== undefined) {\n        data.irtemp   = msg.payload.d.object_temp;   // Typical Android datastructure\n    }\n\n    if (msg.payload.d.objectTemp !== undefined) {\n        data.irtemp   = msg.payload.d.objectTemp;    // Typical Simulator datastructure\n    }\n    //--------------------------------------------------------------------------\n    data.optical = 0; // default if not defined by others\n\n    if (msg.payload.d.optical !== undefined) {\n        data.optical  = msg.payload.d.optical;      // Typical Apple datastructure\n    }\n\n    if (msg.payload.d.light !== undefined) {\n        data.optical  = msg.payload.d.light;      // Typical Android datastructure\n    }\n    //--------------------------------------------------------------------------\n    data.deviceId = msg.deviceId; // Typical datastructure for all\n\n  // *****************\n  // Add your additional sensor data\n    data.sensorImage = \"img/sensor-detail.png\";\n    data.comment = \"Currently on comment\";\n    data.sensorType = \"Simplelink SensorTag - TI.com\";\n\n    data.image    = \"undefined\";\n    data.imageLocalURI = \"undefined\";\n\n  // *****************\n  // Define your Device Type which ICON should be dispayed\n  // ======================================================\n  // You can get the Device ID from your TI App on your mobile device.\n  //\n  // (iPad:94128ececff1) (iPhone:08b5cbcfa326) (Samsung:c4be84722b07)\n  // http://www.w3schools.com/jsref/jsref_localecompare.asp\n  var ipad = \"94128ececff1\";\n  var iphone = \"1247823ebf04\"; // \"08b5cbcfa326\";\n  var samsung = \"c4be84722b07\";\n\n  if(data.deviceId.localeCompare(\"94128ececff1\") == 0){\n     data.deviceType=\"iPad\";\n     data.deviceImageURI=\"img/ipad.png\";\n  }\n\n  if(data.deviceId.localeCompare(\"08b5cbcfa326\") == 0){\n     data.deviceType=\"iPhone\";\n     data.deviceImageURI=\"img/iphone.png\";\n  }\n\n  if(data.deviceId.localeCompare(\"c4be84722b07\") == 0){\n     data.deviceType=\"Samsung\";\n     data.deviceImageURI=\"img/samsung.png\";\n  } else {\n     data.deviceType=\"Container\";\n     data.deviceImageURI=\"img/container.png\";\n  }\n\n  // *****************\n  // Ehningen 48.65891, 8.940540000000055\n  // http://www.viewphotos.org/germany/coordinates-of-Ehningen-5390.html\n  data.gtfs_latitude  = \"48.6589\";\n  data.gtfs_longitude = \"8.940540000000055\";\n\n  // Check Temperature\n  if ( data.temp < 25 )\n  {\n     data.message= data.date + \"/\" + data.time + \" (\" + data.temp + \") within safe limits\";\n     data.status =\"SAFE\";\n  } else {\n     data.message= data.date + \"/\" + data.time + \" (\" + data.temp + \") is in critical limits\";\n     data.status =\"CRITICAL\";\n  }\n\n  // *****************\n  // Build data your own datastructure\n  // -> create json root object\n  sensorroot = new Object();\n  sensorroot.sensordatavalue = data;\n\n  // *****************\n  // Set your data as the payload,\n  // which will be used in the next node as input.\n  msg.payload = sensorroot;\n} else {\n    msg.payload = \"No IoT Data Input\";\n}// if else msg != null end\n\nreturn msg;","outputs":1,"noerr":0,"x":196,"y":289,"wires":[["73a6b11b.8c595","536808d7.ac97f8"]]},{"id":"73a6b11b.8c595","type":"debug","z":"fa7c7cbc.05838","name":"device data","active":false,"console":"false","complete":"true","x":475.9775390625,"y":288.87518310546875,"wires":[]},{"id":"536808d7.ac97f8","type":"cloudant out","z":"fa7c7cbc.05838","service":"MyTempIoTDemo01-cloudantNoSQLDB","cloudant":"","name":"Store IoT Data in Cloudant","database":"my_demo_iot_db","payonly":true,"operation":"insert","x":477,"y":339,"wires":[]},{"id":"fe8bf170.01741","type":"inject","z":"fa7c7cbc.05838","name":"Start messages","topic":"","payload":"The temperature is in safe limits! This is a text to speech check!","payloadType":"string","repeat":"22","crontab":"","once":true,"x":109.0909423828125,"y":353.727294921875,"wires":[["67f6032c.9809fc"]]},{"id":"e5b18e03.1a4e7","type":"debug","z":"fa7c7cbc.05838","name":"Actual Temperature","active":false,"console":"false","complete":"payload","x":686,"y":132,"wires":[]},{"id":"67f6032c.9809fc","type":"watson-text-to-speech","z":"fa7c7cbc.05838","name":"MyText2Speech","lang":"english","voice":"en-US_MichaelVoice","x":688.5,"y":219.00006103515625,"wires":[["4514889d.baeb78","84eea735.7b1158"]]},{"id":"4514889d.baeb78","type":"function","z":"fa7c7cbc.05838","name":"From Speech to Payload","func":"// \nmsg.payload = msg.speech;\n\nreturn msg;","outputs":1,"noerr":0,"x":745.3182373046875,"y":292.54547119140625,"wires":[["f99ee58.f066118","a1ffc54a.5e0038"]]},{"id":"f99ee58.f066118","type":"debug","z":"fa7c7cbc.05838","name":"payload output","active":false,"console":"false","complete":"true","x":971.5,"y":293,"wires":[]},{"id":"84eea735.7b1158","type":"debug","z":"fa7c7cbc.05838","name":"pure text to speech output","active":false,"console":"false","complete":"true","x":872.5,"y":178,"wires":[]},{"id":"c2bac3bf.3d454","type":"websocket out","z":"fa7c7cbc.05838","name":"The WebSocket /ws/audio","server":"894bd09f.76b43","client":"","x":954.5,"y":366,"wires":[]},{"id":"a1ffc54a.5e0038","type":"delay","z":"fa7c7cbc.05838","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":726,"y":366,"wires":[["c2bac3bf.3d454"]]},{"id":"458a69d9.ba7598","type":"cloudant in","z":"fa7c7cbc.05838","service":"MyTempIoTDemo01-cloudantNoSQLDB","cloudant":"","name":"Get all docs","database":"my_demo_iot_db","search":"_all_","design":"","index":"","x":259,"y":443,"wires":[["2fa3773d.d05c88","8af1aa5b.750e58"]]},{"id":"2fa3773d.d05c88","type":"function","z":"fa7c7cbc.05838","name":"Get Do Count","func":"var count = msg.payload.length;\n\nmsg.payload = \"Cloudant contains (\" + count + \") docs\";\n\nreturn msg;","outputs":"1","noerr":0,"x":469.3333740234375,"y":443.22216796875,"wires":[["6caad893.935528"]]},{"id":"6caad893.935528","type":"debug","z":"fa7c7cbc.05838","name":"","active":false,"console":"false","complete":"payload","x":672.3333740234375,"y":442.2222900390625,"wires":[]},{"id":"3aabee2d.c55412","type":"inject","z":"fa7c7cbc.05838","name":"Start get Data","topic":"","payload":"","payloadType":"string","repeat":"30","crontab":"","once":false,"x":101,"y":443,"wires":[["458a69d9.ba7598","4652ed72.b9ad14"]]},{"id":"8af1aa5b.750e58","type":"function","z":"fa7c7cbc.05838","name":"Extract Data","func":"var count = msg.payload.length;\n\nvar list = [];\nfor (i=0;i<count;i++) {\nlist.push({\n        _id: msg.payload[i]._id,\n        _rev: msg.payload[i]._rev,\n        message: msg.payload[i].sensordatavalue.message,\n        temp: msg.payload[i].sensordatavalue.temp,\n        irtemp: msg.payload[i].sensordatavalue.irtemp,\n        date: msg.payload[i].sensordatavalue.date,\n        time: msg.payload[i].sensordatavalue.time,\n        optical: msg.payload[i].sensordatavalue.optical,\n        status: msg.payload[i].sensordatavalue.status,\n        deviceId: msg.payload[i].sensordatavalue.deviceId,\n        deviceType: msg.payload[i].sensordatavalue.deviceType,\n        gtfs_latitude: msg.payload[i].sensordatavalue.gtfs_latitude,\n        gtfs_longitude: msg.payload[i].sensordatavalue.gtfs_longitude,\n        image: msg.payload[i].sensordatavalue.image,\n        imageLocalURL: msg.payload[i].sensordatavalue.imageLocalURL,\n        comment : msg.payload[i].sensordatavalue.comment\n    });\n}\n\nmsg.payload = {\n                \"docs\": \n                list\n               }\nreturn msg;","outputs":"1","noerr":0,"x":466,"y":487,"wires":[["6caad893.935528","d211a4fc.2dee58","9ec49118.613b7"]]},{"id":"d211a4fc.2dee58","type":"websocket out","z":"fa7c7cbc.05838","name":"","server":"25eb0ab4.da14f6","client":"","x":681,"y":484,"wires":[]},{"id":"9ec49118.613b7","type":"websocket out","z":"fa7c7cbc.05838","name":"","server":"6ab4cd3e.954b34","client":"","x":672,"y":523,"wires":[]},{"id":"29a4eee3.d65b12","type":"debug","z":"fa7c7cbc.05838","name":"Cloudant Data","active":true,"console":"false","complete":"payload","x":675,"y":568,"wires":[]},{"id":"b11468a6.4eeb98","type":"http in","z":"fa7c7cbc.05838","name":"","url":"/cloudant","method":"get","swaggerDoc":"","x":81,"y":685,"wires":[["a7eedc50.58112"]]},{"id":"dbec58bc.2413a8","type":"http response","z":"fa7c7cbc.05838","name":"http://YOUR_BLUEMIN_URL/cloudant","x":691,"y":685,"wires":[]},{"id":"a7eedc50.58112","type":"template","z":"fa7c7cbc.05838","name":"Show Sensor Cloudant Data on WebSite","field":"payload","format":"html","template":"<!DOCTYPE html>\n<html>\n  <head>\n    <style>\n        body {\n        background-color: linen;\n        }\n\n        h1 {\n          color: maroon;\n          margin-left: 40px;\n        }\n        table, th, td {\n          border: 1px solid black;\n        }\n        #header {\n         background-color:black;\n         color:white;\n         text-align:center;\n         padding:5px;\n        }\n        #footer {\n         background-color:black;\n         color:white;\n         clear:both;\n         text-align:center;\n         padding:5px;\n        }\n    </style>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <title>Extract Cloudant Data</title>\n    <script type=\"text/javascript\">\n\t\tfunction initialize() {\n\t      var loc = window.location;\n          var messageCount = 0;\n\t      var sensorGeoPage=\"\"\n          if (loc.protocol === \"https:\") {\n            newUri = \"wss:\";\n          } else {\n            newUri = \"ws:\";\n          }\n          newUri += \"//\" + loc.host + \"/ws/cloudant\";\n          sensorGeoPage=loc.protocol + \"//\" + loc.host + \"/map\";\n\n\t\t  var output = document.getElementById('output');\n\n\t\t  var sock = new WebSocket(newUri);\n\n\t\t  sock.onopen = function(){\n\t\t    //$('#output').text('Waiting for cloudant data ...');\n\t\t    console.log(\"Connected websocket\");\n\t\t    console.log(\"Sending ping..\");\n\t\t\t  sock.send(\"Ping!\");\n\t\t    console.log(\"Ping sended..\");\n\t\t  };\n\n\t\t  sock.onerror = function(){\n\t\t      document.write(\"<p>Problem Error!!</p>\");\n\t\t      console.log(\"Websocket error\");\n\n\t\t  };\n\n\t\t  sock.onmessage = function(evt){\n            message = \"getting message\" + messageCount;\n            messageCount++;\n\t\t    console.log(message);\n\t\t    document.write(\"<style>body{background-color: linen;}h1{color: maroon;margin-left: 40px;}table, th, td {border: 1px solid black;}</style>\");\n\t\t    document.write(\"<p>Cloudant Sensor Data are available!</p>\");\n\t\t    document.write(\"<p>***************************</p>\");\n\t\t    // document.write(evt.data);\n\t\t    // document.write(\"<p>***************************</p>\");\n\t\t    var sensorData = JSON.parse(evt.data);\n\t\t    document.write(\"<p>Show Table</p>\");\n\t\t    document.write(\"<a href=\"+sensorGeoPage+\">Go to Senosor Geo Page</a>\");\n\t\t    document.write(\"<p>***************************</p>\");\n\n\t\t    var myTable= \"<table>\";\n\t\t    myTable+=\"<tr>\";\n\t\t    myTable+=\"<td style='width: auto; color: black; text-align: center;'>Count</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Message</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Temperature</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>DeviceId</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>DeviceType</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>GeoLocation</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Date and Time</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Status</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Image</td>\";\n            myTable+=\"<td style='width: auto; color: black; text-align: center;'>Comment</td>\";\n            myTable+=\"</tr>\";\n            //myTable+=\"<tr><td style='width: 100px;                   '>---------------</td>\";\n            //myTable+=\"<td     style='width: 100px; text-align: right;'>---------------</td>\";\n            //myTable+=\"<td     style='width: 100px; text-align: right;'>---------------</td></tr>\";\n\n\t\t    var sensors = sensorData.docs;\n\n        for(var i = 0; i < sensors.length; i++) {\n  \t\t\t  var sensor = sensors[i];\n  \t\t\t  //output = document.write(\"<p>\"+ sensor + \"</p>\");\n  \t\t\t  myTable+=\"<tr>\";\n  \t\t\t  myTable+=\"<td style='width: auto; color: blue; text-align: left;'>(\" + i + \")</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'>\" + sensor.message + \"</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'>\" + sensor.temp + \"</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'>\" + sensor.deviceId + \"</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'>\" + sensor.deviceType + \"</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'> (\" + sensor.gtfs_latitude + \"):(\" + sensor.gtfs_longitude  + \")</td>\";\n                myTable+=\"<td style='width: auto; color: blue; text-align: left;'> (\" + sensor.date + \"):(\" + sensor.time  + \")</td>\";\n                myTable+=\"<td style='width: auto; color: black; text-align: left;'> <b>\" + sensor.status +\"</b></td>\";\n                myTable+=\"<td style=''><img width='100' height='100' alt='No Image' src='\"+ sensor.image +\"'/></td>\";\n                myTable+=\"<td style='width: auto; color: black; text-align: left;'> <b>\" + sensor.comment +\"</b></td>\"\n                myTable+=\"</tr>\";\n  \t\t\t}\n\n  \t\t\tmyTable+=\"</table>\";\n              document.write( myTable);\n  \t\t  };\n\t\t};\n    </script>\n  </head>\n  <body>\n    <!-- *****     CHANGES  ***** -->\n    <!-- Insert YOUR BLUEMIX URL  -->\n    <div id=\"header\">\n      <p>Hello this is the Cloudant Sensor Data Site ... </p> <a href=\"http://YOUR BLUEMIX URL/map\">Go to Senosor Data Page</a>\n    </div>\n    <div id=\"output\">Connecting to Socket to get the Cloudant Sensor Data...</div>\n    <script type=\"text/javascript\">\n       initialize();\n    </script>\n    <div id=\"footer\">\n       IoT Bluemix Mobile Sample Page\n    </div>\n  </body>\n</html>","x":334,"y":685,"wires":[["dbec58bc.2413a8"]]},{"id":"d37184a2.2c8e78","type":"template","z":"fa7c7cbc.05838","name":"Show Geo WebSite with Sensor Cloudant Data ","field":"payload","format":"html","template":"<!--- \n<script src=\"https://maps.googleapis.com/maps/api/js?v=3.exp\"></script> \n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyA3WyzWuy4yav_YeS15_m0-322r-EnEl_c&sensor=true\"></script>\n<script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyA3WyzWuy4yav_YeS15_m0-322r-EnEl_c\"></script>\n-->\n\n<!DOCTYPE html>\n<html>\n  <head>\n    <meta name=\"viewport\" content=\"initial-scale=1.0, user-scalable=no\">\n    <meta charset=\"utf-8\">\n    <title>Sensor Geo Data</title>\n    <style>\n      html, body, #map-canvas {\n        height: 100%;\n        margin: 0px;\n        padding: 0px\n      }\n      #header {\n        background-color:black;\n        color:white;\n        text-align:center;\n        padding:5px;\n      }\n      #footer {\n        background-color:black;\n        color:white;\n        clear:both;\n        text-align:center;\n        padding:5px; \n      }\n    </style>\n    <script src=\"https://maps.googleapis.com/maps/api/js?v=3.exp\"></script>\n    <script>\n\t\tfunction initialize() {\n\t\t  \n\t\t  var loc = window.location;\n          if (loc.protocol === \"https:\") {\n            newUri = \"wss:\";\n          } else {\n            newUri = \"ws:\";\n          }\n          newUri += \"//\" + loc.host + \"/ws/map\";\n\t\t  \n\t\t  var sock = new WebSocket(newUri);\n\t\t  var stuttgart = new google.maps.LatLng(48.76666672,9.1833333);\n\t\t  var mapOptions = {\n\t\t     zoom: 10,\n\t\t     center: stuttgart\n\t\t    };\n\t\t  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);\n\t\t  \n\t\t  sock.onopen = function(){ \n\t\t    console.log(\"Connected websocket\");\n\t\t    console.log(\"Sending ping..\");\n\t\t  \tsock.send(\"Ping!\");\n\t\t    console.log(\"Ping sended..\");\n\t\t  };\n\t\t  \n\t\t  sock.onerror = function(){ \n\t\t      console.log(\"Websocket error\"); \n\t\t      \n\t\t  };\n\t\t  \n\t\t  sock.onmessage = function(evt){\n\t\t    console.log(\"getting message\");\n\t\t    \n\t\t    var sensorData = JSON.parse(evt.data);\n\t\t    var sensors = sensorData.docs;\n\t\t    var logmessage=\"\";\n\t\t    var geotitle=\"\";\n\t\t    \n\t\t    console.log(\"in 'onmessage'\");\n\t\t    \n\t\t\tfor(var i = 0; i < sensors.length; i++) {\n\t\t\t  var sensor   = sensors[i];\n\t\t\t  // var j       = i * i;\n\t\t\t  // var move     = \"6\"+ j;\n\t\t\t  // var move2     = \"5\"+ j;\n\t\t\t  // var latitude = sensor.gtfs_latitude.replace(\"65\", move);\n\t\t\t  // var longitude = sensor.gtfs_longitude.replace(\"94\", move2);\n\t\t\t  \n\t\t\t  var longitude = sensor.gtfs_longitude;\n\t\t\t  var latitude = sensor.gtfs_latitude;\n\t\t\t  \n\t\t\t  logmessage=\"Count [\"+i+\"] Sensor ID: [\"+sensor.deviceId+\"] Status: [\"+sensor.status+\"]\";\n\t\t\t  console.log(logmessage);\n\t\t\t  geotitle=\"Device: (\" + sensor.deviceId + \") Status: (\" + sensor.status +\") Date: (\"+ sensor.date + \") Time: (\" + sensor.time +\")\";\n\t\t\t  logmessage=\"Geo Title: \" + geotitle;\n\t\t\t  console.log(logmessage);\n\t\t\t  logmessage=\"La {\" + latitude + \"} Lo {\" + longitude + \"}\";\n\t\t\t  console.log(logmessage);\n\t\t\t  //geotitle=\"Title\"+i;\n\t\t\t  \n\t\t\t  var marker = new google.maps.Marker({\n\t\t\t    position: new google.maps.LatLng(latitude,longitude),\n\t\t\t    map: map,\n\t\t\t    animation: google.maps.Animation.DROP,\n\t\t\t    title: geotitle\n\t\t\t  });\n\t\t\t}\n\t\t\t\n\t\t\tvar marker = new google.maps.Marker({\n\t\t\t    position: new google.maps.LatLng(48.76666672,9.1833333),\n\t\t\t    map: map,\n\t\t\t    animation: google.maps.Animation.DROP,\n\t\t\t    title: \"Home Location - Stuttgart\"\n\t\t\n\t\t\t });\n\t\t\t \n\t\t\t var infowindow = new google.maps.InfoWindow({\n                    content: '<p>Marker Location:' + marker.getPosition() + '</p>'\n             });\n\t\t  };\n\t\t};\n\t\tgoogle.maps.event.addDomListener(window, 'load', initialize);\n    </script>\n  </head>\n  <body>\n    <!-- *****     CHANGES  ***** -->\n    <!-- Insert YOUR BLUEMIX URL  -->\n    <div id=\"header\">\n      <p>Hello this is the Cloudant Sensor Geo Data Site ... </p> <a href=\"http://YOUR BLUEMIX URL/cloudant\">Go to Senosor Data Page</a>\n    </div>\n    <div id=\"output\">Connecting to Socket to get the Cloudant Sensor Geo Data...</div>\n    <div id=\"map-canvas\"></div>\n    <div id=\"footer\">\n       IoT Bluemix Mobile Sample Page\n    </div>\n  </body>\n</html>","x":344,"y":644,"wires":[["4e8ee552.b1711c"]]},{"id":"4f3534c7.b0cacc","type":"http in","z":"fa7c7cbc.05838","name":"","url":"/map","method":"get","swaggerDoc":"","x":71,"y":644,"wires":[["d37184a2.2c8e78"]]},{"id":"4e8ee552.b1711c","type":"http response","z":"fa7c7cbc.05838","name":"http://YOUR_BLUEMIN_URL/map","x":702,"y":644,"wires":[]},{"id":"4da8c9fd.b25738","type":"http in","z":"fa7c7cbc.05838","name":"","url":"/audio","method":"get","swaggerDoc":"","x":71,"y":609,"wires":[["c910587c.36efa8"]]},{"id":"7ffc9314.80036c","type":"http response","z":"fa7c7cbc.05838","name":"http://YOUR_BLUEMIN_UR/audio","x":697.5455322265625,"y":608.272705078125,"wires":[]},{"id":"c910587c.36efa8","type":"template","z":"fa7c7cbc.05838","name":"Get audio and play the audio in Browser","field":"","template":"<!DOCTYPE html>\n<html>\n<head>\n  <title>IBM Watson - Text To Speech</title>\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"></script>\n  \n  <script type=\"text/javascript\">\n    var socketaddy = \"ws://\" + window.location.host + \"/ws/audio\";\n\n    $(document).ready(function(){\n      var output = document.getElementById('output')\n      $('#output').on('playing', function () {\n          $('#text').text('Playing audio.')\n          \n      });\n      $('#output').on('ended', function () {\n          $('#text').text('Waiting for audio...')\n          \n      });\n      sock = new WebSocket(socketaddy);\n      sock.onopen = function(){\n          $('#text').text('Waiting for audio...');\n          console.log(\"Connected websocket\");\n      };\n      sock.onerror = function(){ \n          console.log(\"Websocket error\"); \n      };\n      sock.onclose = function () {\n          $('#text').text('Not connected. Refresh the page?')\n      }\n      sock.onmessage = function(evt){\n        console.log(\"Websocket message\", evt); \n        output.src = window.URL.createObjectURL(evt.data);\n        output.play();\n      };\n    });\n  </script>\n  \n</head>\n<body style=\"font-size: 56px; font-family: helvetica; text-align: center; margin-top: 100px;\">\n  <div id=\"text\">Connecting...</div>\n  <audio id=\"output\"></audio>\n</body>\n</html>","x":328,"y":609,"wires":[["7ffc9314.80036c"]]},{"id":"acf9002.f5307","type":"cloudant in","z":"fa7c7cbc.05838","service":"MyTempIoTDemo01-cloudantNoSQLDB","cloudant":"","name":"Search for given Value","database":"my_demo_iot_db","search":"_idx_","design":"_d_search","index":"_inx_all","x":455,"y":568,"wires":[["29a4eee3.d65b12"]]},{"id":"4652ed72.b9ad14","type":"function","z":"fa7c7cbc.05838","name":"Search Value (\"theStatus:C*\")","func":"msg.payload = \"theStatus:C*\"; \nreturn msg;","outputs":1,"noerr":0,"x":193,"y":568,"wires":[["acf9002.f5307"]]}]
